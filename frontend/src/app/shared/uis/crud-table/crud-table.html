<div class="crud-card">
  <div class="crud-table__toolbar">
    <div class="crud-table__left">
      @if (showSearch()) {
        <div class="search-bar crud-table__search" role="search" [style.max-width]="searchMaxWidth()">
          <mat-icon fontIcon="search" class="search-icon" aria-hidden="true"></mat-icon>
          <input
            type="search"
            #q
            (input)="onSearch(q.value)"
            [placeholder]="searchPlaceholder()"
            aria-label="Rechercher"
            class="search-input"
          />
        </div>
      }
    </div>
    <div class="crud-table__center">
      <div class="crud-table__title">{{ title() }}</div>
    </div>
    <div class="crud-table__right">
      <button mat-icon-button color="primary" aria-label="Ajouter un élément" (click)="addItem.emit()">
        <mat-icon fontIcon="add"></mat-icon>
      </button>
    </div>
  </div>

  <table mat-table [dataSource]="dataSource()" class="mat-elevation-z2 demo-table">

    @for (columnKey of columnKeys(); track columnKey) {
      @if (columnKey === 'actions') {
        <!-- Colonne d'actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="actions-column">Actions</th>
          <td mat-cell *matCellDef="let element" class="actions-column">
            <div class="actions-container">
              @for (action of actions(); track action.icon) {
                <button
                  mat-icon-button
                  [color]="action.color || 'primary'"
                  [matTooltip]="action.tooltipKey | transloco"
                  (click)="action.callback(element)"
                  class="action-button"
                >
                  <mat-icon [fontIcon]="action.icon"></mat-icon>
                </button>
              }
            </div>
          </td>
        </ng-container>
      } @else {
        <!-- Colonnes normales -->
        <ng-container [matColumnDef]="columnKey">
          <th mat-header-cell *matHeaderCellDef>
            @if (getColumnConfig(columnKey)) {
              {{ getColumnConfig(columnKey)!.headerKey | transloco }}
            } @else {
              {{ columnKey }}
            }
          </th>
          <td mat-cell *matCellDef="let element">
            {{ resolveCellValue(columnKey, element) }}
          </td>
        </ng-container>
      }
    }

    <tr mat-header-row *matHeaderRowDef="columnKeys()"></tr>
    <tr mat-row *matRowDef="let row; columns: columnKeys();"></tr>

    <!-- État vide: ligne couvrant toutes les colonnes -->
    <tr class="mat-mdc-row" *matNoDataRow>
      <td class="mat-mdc-cell crud-table__empty" [attr.colspan]="columnKeys().length">
        {{ emptyMessage() }}
      </td>
    </tr>

  </table>
</div>
