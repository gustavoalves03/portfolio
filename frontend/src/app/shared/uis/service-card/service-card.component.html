<article class="service-card" [class.flipped]="isFlipped()">
  <!-- Front Face: 60% Image + 40% Content -->
  <div class="service-card-front">
    <!-- Image Section (60%) -->
    <div class="service-image-wrapper"
         (touchstart)="onTouchStart($event)"
         (touchend)="onTouchEnd($event, images().length)">
      @if (hasImages()) {
        <img [src]="images()[getCurrentImageIndex()].url"
             [alt]="care().name"
             class="service-image" />

        <!-- Navigation Chevrons -->
        @if (hasMultipleImages()) {
          <div class="carousel-controls">
            <button class="carousel-btn carousel-btn-prev"
                    (click)="previousImage(images().length, $event)"
                    type="button"
                    aria-label="Image précédente">
              <mat-icon>chevron_left</mat-icon>
            </button>

            <button class="carousel-btn carousel-btn-next"
                    (click)="nextImage(images().length, $event)"
                    type="button"
                    aria-label="Image suivante">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>

          <!-- Image indicators -->
          <div class="carousel-indicators">
            @for (img of images(); track img.id; let i = $index) {
              <span class="indicator-dot"
                    [class.active]="i === getCurrentImageIndex()"></span>
            }
          </div>
        }
      } @else {
        <div class="service-image-placeholder">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor" class="w-32 h-32 text-rose-200">
            <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
          </svg>
        </div>
      }
    </div>

    <!-- Content Section (40%) -->
    <div class="service-content">
      <h2 class="service-title">{{ care().name }}</h2>
      <button class="booking-button" (click)="toggleBooking()">
        <span>Rendez-vous</span>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Back Face: Booking Calendar -->
  <div class="service-card-back">
    <div class="booking-header">
      <button class="back-button" (click)="toggleBooking()">
        <mat-icon>arrow_back</mat-icon>
        <span>Retour</span>
      </button>
      <h3 class="booking-title">{{ care().name }}</h3>
    </div>

    <div class="booking-content">
      <ng-content select="[calendar]"></ng-content>
      <ng-content select="[times]"></ng-content>
    </div>

    <div class="booking-footer">
      <div class="booking-summary">
        <span class="price">{{ care().price | currency:'EUR':'symbol':'1.0-0' }}</span>
        <span class="duration">{{ care().duration }} min</span>
      </div>
      <ng-content select="[confirmButton]"></ng-content>
    </div>
  </div>
</article>
